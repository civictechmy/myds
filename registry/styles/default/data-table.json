{
  "name": "data-table",
  "type": "components:ui",
  "dependencies": [
    "@tanstack/react-table",
    "class-variance-authority"
  ],
  "registryDependencies": [
    "button",
    "checkbox",
    "column-collapse",
    "column-expand",
    "icons",
    "table",
    "utils"
  ],
  "files": [
    {
      "path": "components/ui/data-table.tsx",
      "content": "import {\n  type Table as TTable,\n  type Column,\n  ColumnDef,\n  flexRender,\n  getCoreRowModel,\n  useReactTable,\n  getSortedRowModel,\n  getFacetedUniqueValues,\n  RowData,\n  RowSelectionState,\n  createColumnHelper,\n  Row,\n  CellContext,\n  ExpandedState,\n  getExpandedRowModel,\n} from \"@tanstack/react-table\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableEmpty,\n  TableFooter,\n  TableHead,\n  TableHeader,\n  TableRow,\n  TableSkeleton,\n  TableTooltip,\n} from \"./table\";\nimport {\n  createContext,\n  CSSProperties,\n  FunctionComponent,\n  ReactNode,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\";\nimport { ColumnCollapseIcon } from \"@/components/ui/icons/column-collapse\";\nimport { ColumnExpandIcon } from \"@/components/ui/icons/column-expand\";\nimport { clx, pick } from \"@/lib/utils\";\nimport { Button, ButtonIcon } from \"./button\";\nimport {\n  ChevronRightIcon,\n  FilterAscIcon,\n  FilterDescIcon,\n  FilterIcon,\n  ReloadIcon,\n} from \"@/components/ui/icons\";\nimport { Checkbox } from \"./checkbox\";\nimport { cva } from \"class-variance-authority\";\n/**\n * Way to define the ColumnMeta type in @tanstack/react-table\n * @see https://tanstack.com/table/v8/docs/api/core/column-def#meta\n */\ndeclare module \"@tanstack/react-table\" {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  interface ColumnMeta<TData extends RowData, TValue> {\n    className?: {\n      header?: string;\n      cell?: string;\n    };\n    sortable?: boolean;\n    expandable?: boolean;\n    tooltip?: ReactNode;\n  }\n}\n\ninterface DataTableProps<TData extends Record<string, any>> {\n  className?: string;\n  columns: ColumnDef<TData>[];\n  data: TData[];\n  loading?: boolean;\n  selection?: {\n    id_by: keyof TData;\n    mode: \"checkbox\" | \"radio\";\n    onSelectionChange?: (value: string[]) => void;\n    enableRowSelection?: boolean | ((row: Row<TData>) => boolean);\n    enableSubRowSelection?: boolean | ((row: Row<TData>) => boolean);\n  };\n  pin?: {\n    left?: string[];\n    right?: string[];\n  };\n  nest?: {\n    id_by: keyof TData;\n  };\n  emptyState?: ReactNode;\n}\n\nconst pin_cva = cva([\"bg-bg-white\"], {\n  variants: {\n    pin_direction: {\n      left: \"sticky z-10\",\n      right: \"sticky z-10 pl-2\",\n      false: \"\",\n    },\n    pin_last: {\n      true: \"\",\n      false: \"\",\n    },\n  },\n  compoundVariants: [\n    {\n      pin_direction: [\"left\"],\n      pin_last: true,\n      className:\n        \"before:right-0 before:border-none before:outline-none before:bottom-0 before:pointer-events-none before:contents-[''] before:absolute top-0 before:w-1 before:bg-transparent before:h-full before:py-0 before:shadow-[inset_3px_0_8px_-8px]\",\n    },\n    {\n      pin_direction: [\"right\"],\n      pin_last: true,\n      className:\n        \"before:left-0 before:border-none before:outline-none before:bottom-0 before:pointer-events-none before:contents-[''] before:absolute top-0 before:w-1 before:bg-transparent before:h-full before:py-0 before:shadow-[inset_-3px_0_8px_-8px]\",\n    },\n  ],\n});\n\nconst th_cva = cva(\n  [\"group transition data-[expanded=true]:border-otl-primary-300\"],\n  {\n    variants: {\n      expandable: {\n        true: \"hover:border-otl-primary-300\",\n      },\n      sortable: {\n        true: \"hover:border-otl-primary-300\",\n      },\n    },\n  },\n);\n\nconst cell_cva = cva([\n  \"md:whitespace-nowrap whitespace-normal break-words\",\n  \"data-[expanded=false]:truncate data-[expanded=false]:max-w-[230px]\",\n]);\n\ninterface DataTableContextProps<TData extends Record<string, any>> {\n  table: TTable<TData> | null;\n  expandableColumns: Record<string, any>;\n  toggleColumnWidth: (columnId: string) => void;\n  loading?: DataTableProps<TData>[\"loading\"];\n  emptyState?: DataTableProps<TData>[\"emptyState\"];\n}\n\nconst DataTableContext = createContext<DataTableContextProps<any>>({\n  table: null,\n  expandableColumns: {},\n  toggleColumnWidth: () => {},\n});\n\ninterface DataTableProviderProps<TData extends Record<string, any>>\n  extends DataTableProps<TData> {\n  children: ReactNode;\n}\nconst DataTableProvider = <TData extends Record<string, any>>({\n  children,\n  className,\n  ...props\n}: DataTableProviderProps<TData>) => {\n  const { columns, data, selection, pin, nest } = props;\n  const [expandableColumns, setExpandableColumns] = useState(\n    pick(columns, \"id\", () => false),\n  );\n  const [rowSelection, setRowSelection] = useState<RowSelectionState>({});\n  const [expandedSelection, setExpandedSelection] = useState<ExpandedState>({});\n\n  const toggleColumnWidth = (columnId: string) => {\n    setExpandableColumns((prev) => ({\n      ...prev,\n      [columnId]: !prev[columnId],\n    }));\n  };\n\n  const _columns = useMemo(() => {\n    switch (selection?.mode) {\n      case \"checkbox\":\n        return [Column.Checkbox<TData>(), ...columns];\n      case \"radio\":\n        return [Column.Radio<TData>(), ...columns];\n      default:\n        return columns;\n    }\n  }, [columns, selection?.mode]);\n\n  const table = useReactTable<TData>({\n    data,\n    columns: _columns,\n    state: {\n      expanded: expandedSelection,\n      rowSelection: rowSelection,\n      columnPinning: {\n        left: pin?.left,\n        right: pin?.right,\n      },\n    },\n    enableRowSelection: selection?.enableRowSelection,\n    enableSubRowSelection: selection?.enableSubRowSelection,\n    enableMultiRowSelection: selection?.mode === \"checkbox\",\n    getRowId: selection?.id_by\n      ? (row) => row[selection.id_by] as string\n      : undefined,\n    getSubRows: nest ? (row) => row[nest.id_by] : undefined,\n    onExpandedChange: setExpandedSelection,\n    onRowSelectionChange: setRowSelection,\n    getExpandedRowModel: getExpandedRowModel(),\n    getCoreRowModel: getCoreRowModel(),\n    getSortedRowModel: getSortedRowModel(),\n    getFacetedUniqueValues: getFacetedUniqueValues(),\n    debugTable: false,\n    debugHeaders: false,\n  });\n\n  useEffect(() => {\n    if (!selection) return;\n    selection?.onSelectionChange?.(Object.keys(table.getState().rowSelection));\n  }, [table.getState().rowSelection]);\n\n  return (\n    <DataTableContext.Provider\n      value={{ table, expandableColumns, toggleColumnWidth, ...props }}\n    >\n      <Table\n        className={className}\n        style={{\n          width: props.pin ? table.getTotalSize() : undefined,\n        }}\n      >\n        {children}\n      </Table>\n    </DataTableContext.Provider>\n  );\n};\n\nconst DataTableHeader: FunctionComponent = () => {\n  const { table, expandableColumns, toggleColumnWidth } =\n    useContext(DataTableContext);\n\n  if (!table) return null;\n\n  return (\n    <TableHeader>\n      {table.getHeaderGroups().map((headerGroup) => {\n        return (\n          <TableRow key={headerGroup.id}>\n            {headerGroup.headers.map((header) => {\n              const { tooltip, expandable, sortable } =\n                header.column.columnDef.meta || {};\n              return (\n                <TableHead\n                  id={header.id}\n                  key={header.id}\n                  colSpan={header.colSpan}\n                  data-expanded={expandableColumns[header.id]}\n                  data-pinned={header.column.getIsPinned()}\n                  className={clx(\n                    th_cva({ expandable, sortable }),\n                    pin_cva({\n                      pin_direction: header.column.getIsPinned(),\n                      pin_last: header.column.getIsLastColumn(\n                        header.column.getIsPinned(),\n                      ),\n                    }),\n                    header.column.columnDef.meta?.className?.header,\n                  )}\n                  style={{ ...getCommonPinningStyles(header.column) }}\n                >\n                  <span className=\"sr-only\">\n                    {(header.column.columnDef.id == \"_checkbox\" ||\n                      header.column.columnDef.id == \"_radio\") &&\n                      \"selection-column\"}\n                  </span>\n                  {header.isPlaceholder ? null : (\n                    <div className=\"flex w-full items-center justify-between gap-2 whitespace-nowrap\">\n                      {flexRender(\n                        header.column.columnDef.header,\n                        header.getContext(),\n                      )}\n\n                      <div className=\"flex justify-end gap-1\">\n                        {/* Expand */}\n                        {expandable && (\n                          <Button\n                            size=\"small\"\n                            variant={\"primary-outline\"}\n                            onClick={() => toggleColumnWidth(header.id)}\n                            className=\"invisible hidden rounded-md px-1 py-0 group-hover:visible data-[expanded=true]:visible lg:block\"\n                            data-expanded={expandableColumns[header.id]}\n                          >\n                            {expandableColumns[header.id] ? (\n                              <ColumnCollapseIcon className=\"text-txt-primary size-4\" />\n                            ) : (\n                              <ColumnExpandIcon className=\"text-txt-primary size-4\" />\n                            )}\n                          </Button>\n                        )}\n\n                        {/* Sortable */}\n                        {sortable && (\n                          <Button\n                            size=\"small\"\n                            variant={\"primary-outline\"}\n                            onClick={header.column.getToggleSortingHandler()}\n                            className=\"invisible hidden rounded-md px-1 py-0 group-hover:visible data-[sorted=true]:visible lg:block\"\n                            data-sorted={Boolean(header.column.getIsSorted())}\n                          >\n                            {{\n                              desc: <FilterDescIcon className=\"size-4\" />,\n                              asc: <FilterAscIcon className=\"size-4\" />,\n                            }[header.column.getIsSorted() as string] ?? (\n                              <FilterIcon className=\"size-4\" />\n                            )}\n                          </Button>\n                        )}\n\n                        {/* Tooltip */}\n                        {tooltip && <TableTooltip>{tooltip}</TableTooltip>}\n                      </div>\n                    </div>\n                  )}\n                </TableHead>\n              );\n            })}\n          </TableRow>\n        );\n      })}\n    </TableHeader>\n  );\n};\n\nconst DataTableBody: FunctionComponent = () => {\n  const { table, expandableColumns, loading, emptyState } =\n    useContext(DataTableContext);\n\n  if (!table)\n    throw new Error(\"Table instance failed to initialize. Please check\");\n\n  return (\n    <TableBody>\n      {loading ? (\n        Array.from({ length: 5 }).map((_, index) => (\n          <TableRow key={index}>\n            {table.getAllLeafColumns().map((column) => (\n              <TableCell key={column.id} className=\"py-3\">\n                <TableSkeleton />\n              </TableCell>\n            ))}\n          </TableRow>\n        ))\n      ) : table?.getRowModel()?.rows?.length > 0 ? (\n        table.getRowModel().rows.map((row) => {\n          return (\n            <TableRow key={row.id}>\n              {row.getVisibleCells().map((cell) => {\n                return (\n                  <TableCell\n                    id={cell.id}\n                    key={cell.id}\n                    data-expanded={expandableColumns[cell.column.id]}\n                    data-pinned={cell.column.getIsPinned()}\n                    className={clx(\n                      cell_cva(),\n                      pin_cva({\n                        pin_direction: cell.column.getIsPinned(),\n                        pin_last: cell.column.getIsLastColumn(\n                          cell.column.getIsPinned(),\n                        ),\n                      }),\n                      cell.column.columnDef.meta?.className?.cell,\n                    )}\n                    style={{ ...getCommonPinningStyles(cell.column) }}\n                  >\n                    {flexRender(cell.column.columnDef.cell, cell.getContext())}\n                  </TableCell>\n                );\n              })}\n            </TableRow>\n          );\n        })\n      ) : (\n        <TableRow>\n          <TableEmpty colSpan={table.getAllLeafColumns().length}>\n            {emptyState || \"No data available\"}\n          </TableEmpty>\n        </TableRow>\n      )}\n    </TableBody>\n  );\n};\n\nconst DataTableFooter: FunctionComponent = () => {\n  const { table, expandableColumns } = useContext(DataTableContext);\n\n  if (!table) return null;\n\n  const footers = table\n    .getFooterGroups()\n    .map((group) =>\n      group.headers.map((header) => header.column.columnDef.footer),\n    )\n    .flat()\n    .filter(Boolean);\n\n  if (footers.length === 0) return;\n\n  return (\n    <TableFooter>\n      {table.getFooterGroups().map((footerGroup) => (\n        <TableRow key={footerGroup.id}>\n          {footerGroup.headers.map((header) => (\n            <TableCell\n              key={header.id}\n              colSpan={header.colSpan}\n              data-expanded={expandableColumns[header.column.id]}\n              data-pinned={header.column.getIsPinned()}\n              className={clx(\n                cell_cva(),\n                pin_cva({\n                  pin_direction: header.column.getIsPinned(),\n                  pin_last: header.column.getIsLastColumn(\n                    header.column.getIsPinned(),\n                  ),\n                }),\n                header.column.columnDef.meta?.className?.cell,\n              )}\n              style={{ ...getCommonPinningStyles(header.column) }}\n            >\n              {header.isPlaceholder\n                ? null\n                : flexRender(\n                    header.column.columnDef.footer,\n                    header.getContext(),\n                  )}\n            </TableCell>\n          ))}\n        </TableRow>\n      ))}\n    </TableFooter>\n  );\n};\n\nconst CheckboxColumn = <TData extends Record<string, any>>() => {\n  const columnHelper = createColumnHelper<TData>();\n  return columnHelper.display({\n    id: \"_checkbox\",\n    size: 46,\n    enableResizing: true,\n    header: ({ table }) => (\n      <Checkbox\n        key=\"checkbox-all\"\n        checked={\n          table.getIsAllRowsSelected() ||\n          (table.getIsSomeRowsSelected() && \"indeterminate\")\n        }\n        aria-label=\"checkbox\"\n        onClick={table.getToggleAllRowsSelectedHandler()}\n      />\n    ),\n    cell: ({ row }) => (\n      <Checkbox\n        key={`checkbox-${row.id}`}\n        checked={row.getIsSelected()}\n        value={row.id}\n        disabled={!row.getCanSelect()}\n        aria-label=\"checkbox\"\n        onClick={row.getToggleSelectedHandler()}\n      />\n    ),\n  });\n};\n\nconst RadioColumn = <TData extends Record<string, any>>() => {\n  const columnHelper = createColumnHelper<TData>();\n  return columnHelper.display({\n    id: \"_radio\",\n    size: 46,\n    enableResizing: false,\n    header: ({ table }) => (\n      <div className=\"flex items-center gap-1\">\n        <Button\n          size=\"small\"\n          variant=\"default-ghost\"\n          onClick={() => table.resetRowSelection(false)}\n          className=\"invisible px-1 py-0 transition data-[selected=true]:visible\"\n          data-selected={table.getIsSomeRowsSelected()}\n        >\n          <ReloadIcon className=\"text-txt-black-500 size-4 rotate-45\" />\n        </Button>\n      </div>\n    ),\n    cell: ({ row }) => (\n      <div\n        className={clx(\n          \"shadow-button hover:border-otl-gray-300 border-otl-gray-200 flex aspect-square size-4 items-center justify-center rounded-full border\",\n          \"focus-within:ring-fr-primary focus-within:ring-4 focus-within:ring-opacity-40 focus:outline-none\",\n          \"has-[:checked]:bg-primary-600 has-[:disabled]:has-[:checked]::bg-primary-600 has-[:checked]:border-none has-[:disabled]:opacity-30\",\n        )}\n      >\n        <input\n          type=\"radio\"\n          aria-label=\"radio\"\n          id={row.id}\n          value={row.id}\n          checked={row.getIsSelected()}\n          disabled={!row.getCanSelect()}\n          onClick={row.getToggleSelectedHandler()}\n          className={clx(\n            \"disabled:bg-bg-washed relative h-full w-full disabled:cursor-not-allowed\",\n            \"before:bg-bg-white before:contents-[''] appearance-none before:absolute before:left-[5px] before:top-[5px] before:size-[6px] before:rounded-full\",\n          )}\n        />\n      </div>\n    ),\n  });\n};\n\nconst ExpandCell = <TData extends Record<string, any>>(\n  { row, getValue }: CellContext<TData, unknown>,\n  cell?: ReactNode,\n) => {\n  const useDefault = !cell || JSON.stringify(cell) === JSON.stringify({});\n  return (\n    <div\n      className=\"flex gap-1\"\n      style={{ paddingLeft: `calc(${row.depth}rem + 4px)` }}\n    >\n      {row.getCanExpand() && (\n        <Button\n          size=\"small\"\n          variant=\"default-ghost\"\n          onClick={row.getToggleExpandedHandler()}\n          data-expanded={row.getIsExpanded()}\n        >\n          <ButtonIcon\n            data-expanded={row.getIsExpanded()}\n            className=\"transform transition-transform data-[expanded=true]:rotate-90\"\n            aria-label=\"expand row\"\n          >\n            <ChevronRightIcon />\n          </ButtonIcon>\n        </Button>\n      )}\n      {useDefault ? (getValue() as string) : cell}\n    </div>\n  );\n};\n\nconst getCommonPinningStyles = <TData extends Record<string, any>>(\n  column: Column<TData>,\n): CSSProperties => {\n  const isPinned = column.getIsPinned();\n  return {\n    left: isPinned === \"left\" ? `${column.getStart(\"left\")}px` : undefined,\n    right: isPinned === \"right\" ? `${column.getAfter(\"right\")}px` : undefined,\n    width: isPinned ? column.getSize() : undefined,\n  };\n};\n\n/**\n * Reserved columns for DataTable\n */\nconst Column = {\n  Checkbox: CheckboxColumn,\n  Radio: RadioColumn,\n};\n\n/**\n * Reserved cells for DataTable\n */\nconst Cell = {\n  Expand: ExpandCell,\n};\n\nconst DataTable = <TData extends Record<string, any>>(\n  props: DataTableProps<TData>,\n) => {\n  return (\n    <DataTableProvider<TData> {...props}>\n      <DataTableHeader />\n      <DataTableBody />\n      <DataTableFooter />\n    </DataTableProvider>\n  );\n};\nDataTable.displayName = \"DataTable\";\n\nexport { DataTable, Cell, type ColumnDef };\n",
      "type": "components:ui"
    }
  ],
  "tailwind": {
    "config": {
      "theme": {
        "extend": {
          "colors": {}
        }
      }
    }
  }
}